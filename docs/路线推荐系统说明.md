# 蜀南竹海智能路线推荐系统

## 📋 概述

本系统为蜀南竹海景区AI客服提供智能路线推荐功能，综合考虑**天气、用户偏好、景点距离、人群特点**等多种因素，为游客生成最优游览路线。

## 🎯 核心功能

### 1. 多维度智能分析

#### 天气适配
- **实时天气查询**：通过高德地图API获取当天或指定日期的天气信息
- **天气场景适配**：
  - 🌞 **晴天**：推荐七彩飞瀑（彩虹效果）、拜寿台（云海）、望龙坪
  - ☁️ **阴天**：推荐忘忧谷、翡翠长廊（光影效果好）
  - 🌧️ **雨天**：推荐博物馆（室内）、翡翠长廊（有遮蔽），避免登高景点
  - 🔥 **炎热**（≥32℃）：推荐忘忧谷、仙寓洞等阴凉景点
  - ❄️ **寒冷**（≤5℃）：推荐室内或活动量适中的景点

#### 人群特点适配
- **亲子游**：
  - ✅ 适合：忘忧谷、七彩飞瀑、仙女湖、博物馆
  - ❌ 不适合：天宝寨（爬山）、竹尖漫步（栈道高）
  - 💡 建议：增加休息频率、携带零食

- **老年游**：
  - ✅ 适合：翡翠长廊、仙女湖、博物馆（平缓路线）
  - ❌ 不适合：天宝寨、龙吟寺、望龙坪（登高景点）
  - 💡 建议：慢节奏、购买观光车票、安排午休

- **徒步爱好者**：
  - ✅ 推荐：竹尖漫步、忘忧谷、天宝寨、花溪十三桥
  - 💡 建议：全程徒步穿越路线（6-8小时）

- **摄影爱好者**：
  - 📷 最佳拍摄点：七彩飞瀑（10:00-11:00）、翡翠长廊、拜寿台（日出）
  - 💡 建议：避开游客高峰、携带三脚架和偏振镜

- **休闲游**：
  - ✅ 推荐：翡翠长廊、仙女湖、海中海、博物馆
  - 💡 特点：慢节奏、享受美食、下午茶

#### 时长适配
- **半日游（4小时）**：2-3个核心景点，紧凑路线
- **一日游（6-8小时）**：5-6个景点，含午餐休息
- **两日游（16小时）**：10-12个景点，深度体验

#### 距离优化
- 采用**最近邻算法**优化景点顺序
- 减少往返，避免走回头路
- 建议：西进东出 或 东进西出

### 2. 景点配置系统

每个景点都配置了以下属性：

```java
- 难度等级：1-简单，2-中等，3-困难
- 建议游览时间（分钟）
- 是否适合儿童
- 是否适合老人
- 是否适合摄影
- 是否雨天友好
- 景点标签
```

### 3. 智能推荐算法

```
1. 获取所有景点信息
2. 根据用户偏好和天气筛选合适景点
3. 计算优先级并排序
4. 根据时长选择景点数量
5. 优化景点顺序（距离最短）
6. 生成详细行程安排
7. 添加个性化提示
```

## 🔧 技术实现

### 核心类

#### 1. `RouteRecommendService.java`
智能路线推荐服务核心类

**主要方法**：
```java
// 推荐路线
RouteRecommendation recommendRoute(UserPreference preference)

// 筛选景点
List<ScenicInfo> filterScenicsByPreference(List<ScenicInfo> scenics, UserPreference preference)

// 优化路线
List<ScenicInfo> optimizeRoute(List<ScenicInfo> scenics, UserPreference preference)

// 生成推荐结果
RouteRecommendation generateRouteRecommendation(List<ScenicInfo> route, UserPreference preference)
```

**数据结构**：
```java
// 用户偏好
UserPreference {
    int duration;              // 游玩时长（小时）
    boolean hasChildren;       // 是否有小孩
    boolean hasElderly;        // 是否有老人
    boolean hiking;            // 是否徒步
    boolean photography;       // 是否摄影
    boolean leisure;           // 是否休闲游
    LocalDate visitDate;       // 游玩日期
    String weatherCondition;   // 天气状况
    int temperature;           // 温度
}

// 路线推荐结果
RouteRecommendation {
    String title;                    // 标题
    String weatherInfo;              // 天气信息
    List<RouteSegment> segments;     // 路线分段
    String tips;                     // 温馨提示
    String summary;                  // 总结
}
```

#### 2. `AiToolService.java`
AI工具服务，提供给AI调用

**方法签名**：
```java
@Tool("根据用户的游玩时长、游玩场景和天气情况智能推荐最合适的游玩路线...")
public String recommendRoute(
    String duration,      // 必填：游玩时长
    String visitDate,     // 可选：游玩日期
    Boolean hasChildren,  // 可选：是否有小孩
    Boolean hasElderly,   // 可选：是否有老人
    Boolean hiking,       // 可选：是否徒步
    Boolean photography,  // 可选：是否摄影
    Boolean leisure       // 可选：是否休闲游
)
```

#### 3. `AiChatServiceImpl.java`
AI聊天服务实现，处理工具调用

**新增方法**：
```java
// 安全获取Boolean参数
private Boolean getArgumentAsBoolean(Map<String, Object> arguments, String... keys)
```

### 集成流程

```
用户询问 
  ↓
AI识别意图 
  ↓
调用 recommendRoute 工具
  ↓
解析参数（时长、日期、人群特点等）
  ↓
查询天气API（如果有日期）
  ↓
构建 UserPreference 对象
  ↓
调用 RouteRecommendService.recommendRoute()
  ↓
  ├─ 筛选景点（基于天气、人群）
  ├─ 优化顺序（距离最短）
  ├─ 分时段安排
  └─ 生成提示
  ↓
格式化输出
  ↓
返回给用户
```

## 📊 景点配置

### 景点属性配置示例

| 景点名称 | 难度 | 时长(分钟) | 儿童 | 老人 | 摄影 | 雨天 | 标签 |
|---------|------|-----------|------|------|------|------|------|
| 忘忧谷 | 2 | 120 | ✅ | ❌ | ✅ | ❌ | 竹林、幽静、瀑布 |
| 天宝寨 | 3 | 90 | ❌ | ❌ | ✅ | ❌ | 登高、古建筑、全景 |
| 七彩飞瀑 | 2 | 60 | ✅ | ✅ | ✅ | ❌ | 瀑布、彩虹、拍照 |
| 翡翠长廊 | 1 | 90 | ✅ | ✅ | ✅ | ✅ | 竹林、步道、取景地 |
| 天皇寺 | 2 | 60 | ✅ | ✅ | ✅ | ✅ | 寺庙、禅意、竹海 |
| 仙女湖 | 1 | 60 | ✅ | ✅ | ✅ | ✅ | 湖泊、休闲、浪漫 |
| 青龙湖 | 1 | 90 | ✅ | ✅ | ✅ | ✅ | 湖泊、游船、休闲 |
| 海中海 | 1 | 60 | ✅ | ✅ | ✅ | ✅ | 湖泊、电影取景地 |
| 博物馆 | 1 | 90 | ✅ | ✅ | ❌ | ✅ | 文化、室内 |

## 🚀 使用示例

### 示例1：简单一日游
**用户**：我想玩一天，有什么推荐吗？

**AI调用**：
```java
recommendRoute(
    duration: "一天",
    visitDate: null,
    hasChildren: null,
    hasElderly: null,
    hiking: null,
    photography: null,
    leisure: null
)
```

**输出**：
```
为您推荐一日游经典路线

⏰ 上午 (08:00-12:00)
📍 忘忧谷 (120分钟) - 竹林、幽静、瀑布、溪流
📍 翡翠长廊 (90分钟) - 竹林、步道、电影取景地

⏰ 中午 (12:00-13:30)
🍽️ 建议在景区餐厅品尝地道竹笋宴和当地特色美食

⏰ 下午 (13:30-17:00)
📍 七彩飞瀑 (60分钟) - 瀑布、彩虹、拍照
📍 观海楼 (60分钟) - 古楼、观景、历史

💡 建议提前购买门票和观光车票，节省排队时间
💡 携带足够的饮用水和适量零食
💡 景区较大，建议购买观光车票
💡 尊重自然，不要破坏竹林

📋 本次行程共游览4个景点，预计总用时约8小时...
```

### 示例2：带小孩和老人的半日游
**用户**：明天上午带父母和5岁小孩去玩半天，有什么合适的路线吗？

**AI调用**：
```java
recommendRoute(
    duration: "半天",
    visitDate: "2025-10-12",
    hasChildren: true,
    hasElderly: true,
    hiking: false,
    photography: false,
    leisure: true
)
```

**AI会自动**：
1. 查询明天天气
2. 过滤掉不适合老人和小孩的景点（如天宝寨）
3. 选择平缓、轻松的景点
4. 生成包含特殊提示的路线

### 示例3：摄影爱好者
**用户**：我是摄影爱好者，后天想去拍照，一天时间

**AI调用**：
```java
recommendRoute(
    duration: "一天",
    visitDate: "2025-10-13",
    hasChildren: false,
    hasElderly: false,
    hiking: false,
    photography: true,
    leisure: false
)
```

**AI会优先推荐**：
- 七彩飞瀑（彩虹效果）
- 翡翠长廊（光影效果）
- 拜寿台（云海日出）
- 并提供最佳拍摄时间

## 📚 知识库文档

系统包含一份详细的路线推荐知识库文档（`route_recommendation_knowledge.sql`），供AI学习和参考：

### 文档内容包括：
1. **路线推荐原则**
   - 天气适配原则
   - 人群适配原则
   - 时长适配原则
   - 距离优化原则

2. **特殊场景推荐**
   - 情侣浪漫游
   - 研学游
   - 团建拓展

3. **温馨提示总结**
   - 必备物品
   - 购票建议
   - 餐饮建议
   - 住宿建议
   - 最佳游览时间

4. **AI推荐策略**
   - 询问关键信息
   - 综合分析
   - 生成推荐
   - 贴心服务

### 导入知识库
```sql
-- 执行SQL文件导入知识库
mysql -u root -p cdu_snzh_miniapp < sql/route_recommendation_knowledge.sql
```

## 🔄 扩展建议

### 1. 增强天气分析
- 加入紫外线指数
- 加入空气质量指数
- 加入降雨概率

### 2. 优化距离计算
- 使用高德地图API实际测量景点间距离
- 考虑交通方式（步行/观光车）
- 考虑实时交通状况

### 3. 个性化推荐
- 用户历史行为分析
- 用户评分和反馈
- 协同过滤推荐

### 4. 实时数据
- 景点实时人流量
- 景点开放状态
- 特殊活动信息

### 5. 多语言支持
- 英文路线推荐
- 日文路线推荐
- 韩文路线推荐

## ⚠️ 注意事项

1. **天气API限制**：高德地图API有调用次数限制，需注意配额
2. **数据准确性**：景点信息需要定期更新维护
3. **异常处理**：当推荐失败时，会降级到简单推荐逻辑
4. **性能优化**：大量景点时需要优化算法性能

## 📝 维护指南

### 更新景点信息
在 `RouteRecommendService.java` 的 `configScenicAttributes()` 方法中更新：

```java
case "新景点名称":
    info.setDifficulty(2);
    info.setRecommendTime(90);
    info.setSuitableForChildren(true);
    info.setSuitableForElderly(true);
    info.setSuitableForPhotography(true);
    info.setRainyDayFriendly(true);
    info.setTags(new String[]{"标签1", "标签2"});
    break;
```

### 调整推荐策略
在 `filterScenicsByPreference()` 方法中调整优先级计算逻辑。

### 更新知识库
修改 `sql/route_recommendation_knowledge.sql` 并重新导入数据库。

## 🎉 总结

本智能路线推荐系统通过综合考虑多种因素，为游客提供个性化、精准的游览路线建议，提升了用户体验和服务质量。系统采用模块化设计，易于维护和扩展。

