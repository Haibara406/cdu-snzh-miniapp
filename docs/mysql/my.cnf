# MySQL 8.0 性能优化配置（可用内存约1G）
# 作用：充分利用可用内存，提供最佳性能

[mysqld]
# ========== 基础设置 ==========
# 字符集
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 时区
default-time-zone = '+08:00'

# 默认认证插件
default-authentication-plugin = mysql_native_password

# 允许所有IP连接（用于远程访问）
bind-address = 0.0.0.0

# ========== 连接设置 ==========
# 最大连接数（可根据实际并发调整）
max_connections = 200

# 连接超时时间
wait_timeout = 600
interactive_timeout = 600

# ========== 内存优化设置 ==========
# InnoDB 缓冲池大小（最重要的参数！建议设为可用内存的50-70%）
# 1G内存 * 60% = 600MB，这里设置为512MB留些余地
innodb_buffer_pool_size = 536870912  # 512MB

# InnoDB缓冲池实例数（提高并发性能，建议为CPU核心数，2核=2）
innodb_buffer_pool_instances = 2

# 表缓存（提高表打开速度）
table_open_cache = 256
table_definition_cache = 1024

# 查询缓存（MySQL 8.0 已移除，此配置无效但保留注释）
# query_cache_size = 0

# 临时表大小（提高复杂查询性能）
tmp_table_size = 64M
max_heap_table_size = 64M

# 排序缓冲区（提高ORDER BY性能）
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 4M

# Join缓冲区（提高JOIN性能）
join_buffer_size = 4M

# 线程缓存（减少线程创建开销）
thread_cache_size = 16

# ========== InnoDB 设置 ==========
# 日志文件大小（增大可提高写入性能）
innodb_log_file_size = 128M
innodb_log_buffer_size = 16M

# 刷新日志策略（1最安全但性能差，2平衡性能和安全，0性能最好但可能丢数据）
innodb_flush_log_at_trx_commit = 2

# 刷新方法（O_DIRECT避免双重缓冲）
innodb_flush_method = O_DIRECT

# 文件每表（每个表独立表空间）
innodb_file_per_table = 1

# I/O线程数（提高并发I/O性能）
innodb_read_io_threads = 4
innodb_write_io_threads = 4

# 后台线程数（提高并发处理能力）
innodb_purge_threads = 2

# 自适应哈希索引（提高查询性能）
innodb_adaptive_hash_index = ON

# ========== 日志设置 ==========
# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/lib/mysql/mysql-slow.log
long_query_time = 2

# 错误日志
log_error = /var/lib/mysql/mysql-error.log

# 二进制日志（如果不需要主从复制可以关闭以节省空间）
# log_bin = /var/lib/mysql/mysql-bin
# binlog_expire_logs_seconds = 604800  # 7天

# ========== 其他优化 ==========
# 跳过DNS解析
skip-name-resolve = 1

# SQL模式（严格模式）
sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

[mysql]
# 客户端字符集
default-character-set = utf8mb4

[client]
# 客户端字符集
default-character-set = utf8mb4

